<div
  class="game-screen"
  [class.hidden]="gameOverVisible"
  [class.shake]="isShaking"
  [class.glitch]="isGlitching"
  [class.chromatic-aberration]="showChromaticAberration"
  [class.zoom-pulse]="showZoomPulse"
  [class.wave-distortion]="showWaveDistortion"
>
  <!-- MEJORA 4: Grid técnico y coordenadas -->
  <div class="technical-grid"></div>
  <div class="tech-overlay">
    <!-- <div class="tech-corner tl">
      <span class="tech-label">UNIT-7829</span>
      <span class="tech-coords">X:{{ techCoords.x }} Y:{{ techCoords.y }}</span>
    </div> -->
    <!-- <div class="tech-corner tr">
      <span class="tech-hex">{{ hexCode1 }}</span>
      <span class="tech-status">ACTIVE</span>
    </div> -->
    <div class="tech-corner bl">
      <span class="tech-hex">{{ hexCode2 }}</span>
      <span class="tech-temp">TEMP: {{ systemTemp }}°C</span>
    </div>
    <div class="tech-corner br">
      <span class="tech-label">SYS-ONLINE</span>
      <span class="tech-hex">{{ hexCode3 }}</span>
    </div>
  </div>

  <!-- Partículas de fondo flotantes -->
  <div class="background-particles">
    <div
      *ngFor="let particle of backgroundParticles"
      class="bg-particle"
      [class.pixel]="particle.isPixel"
      [style.left.px]="particle.x"
      [style.top.px]="particle.y"
      [style.width.px]="particle.size"
      [style.height.px]="particle.size"
      [style.opacity]="particle.opacity"
    ></div>
  </div>

  <!-- Flash de pantalla -->
  <div
    class="screen-flash"
    [class.flash-success]="screenFlash === 'success'"
    [class.flash-error]="screenFlash === 'error'"
  ></div>

  <!-- Sistema de partículas -->
  <div class="particles-container">
    <div
      *ngFor="let particle of particles"
      class="particle"
      [style.left.px]="particle.x"
      [style.top.px]="particle.y"
      [style.opacity]="particle.life"
      [style.width.px]="particle.size"
      [style.height.px]="particle.size"
      [style.background-color]="particle.color"
    ></div>
  </div>

  <!-- Chispas eléctricas para game over -->
  <div class="sparks-container" *ngIf="showSparks">
    <div
      class="spark"
      *ngFor="let i of [1, 2, 3, 4, 5, 6, 7, 8]"
      [class]="'spark spark-' + i"
    ></div>
  </div>

  <!-- Header con puntuación -->
  <div class="game-header">
    <div class="stat">
      <span class="stat-label">{{
        translationService.translate("game.round")
      }}</span>
      <span class="stat-value">{{ formattedRound }}</span>
    </div>
    <div class="center-warning">
      <div class="warning-led red"></div>
      <span class="warning-text">CRITICAL</span>
      <div class="warning-led red"></div>
    </div>
    <div class="stat">
      <span class="stat-label">{{
        translationService.translate("game.score")
      }}</span>
      <span class="stat-value">{{ formattedScore }}</span>
    </div>
  </div>

  <!-- Marco del monitor con timer de segmentos -->
  <div class="monitor-container" [class.crt-distortion]="true">
    <div
      class="monitor-frame"
      [class.error-feedback]="showErrorFeedback"
      [class.victory-feedback]="showVictoryFeedback"
    >
      <div class="monitor-screw tl"></div>
      <div class="monitor-screw tr"></div>
      <div class="monitor-screw bl"></div>
      <div class="monitor-screw br"></div>
      <div class="screen-scanline"></div>

      <!-- Timer de progreso horizontal profesional -->
      <div class="timer-bar-container">
        <div class="timer-bar">
          <div
            *ngFor="let segment of segments; let i = index"
            class="timer-bar-segment"
            [class.active]="segment.active"
            [class.warning]="segment.warning"
            [class.danger]="segment.danger"
          ></div>
        </div>
      </div>

      <div class="instruction-area">
        <p
          id="instruction"
          [class.typing]="isTyping"
          [class.glitch-text]="isGlitching"
        >
          {{
            displayedInstruction ||
              currentChallenge?.text ||
              "SYSTEM INITIALIZING..."
          }}<span class="cursor" *ngIf="isTyping">_</span>
        </p>
      </div>
    </div>
  </div>

  <!-- Botones industriales -->
  <div class="buttons-area">
    <button class="press-button red-btn" (click)="onRedButtonClick($event)">
      <div class="button-frame">
        <div class="button-corner tl"></div>
        <div class="button-corner tr"></div>
        <div class="button-corner bl"></div>
        <div class="button-corner br"></div>
        <div class="button-led-indicator"></div>
        <span class="button-label">SYSTEM A</span>
        <span class="button-sublabel">RED</span>
      </div>
    </button>
    <button class="press-button blue-btn" (click)="onBlueButtonClick($event)">
      <div class="button-frame">
        <div class="button-corner tl"></div>
        <div class="button-corner tr"></div>
        <div class="button-corner bl"></div>
        <div class="button-corner br"></div>
        <div class="button-led-indicator"></div>
        <span class="button-label">SYSTEM B</span>
        <span class="button-sublabel">BLUE</span>
      </div>
    </button>
  </div>
</div>

<!-- Pantalla de Game Over -->
<div class="screen" [class.hidden]="!gameOverVisible">
  <div class="panel-frame error-frame">
    <div class="screw top-left"></div>
    <div class="screw top-right"></div>
    <div class="screw bottom-left"></div>
    <div class="screw bottom-right"></div>
    <div class="content">
      <div class="error-lights">
        <div class="error-led"></div>
        <div class="error-led"></div>
        <div class="error-led"></div>
      </div>
      <h1 class="game-over-title">
        {{ translationService.translate("game.gameOver") }}
      </h1>
      <p class="game-over-reason">{{ gameOverReason }}</p>
      <div class="final-stats">
        <div class="final-stat">
          <div class="stat-label">
            {{ translationService.translate("game.round") }}
          </div>
          <div class="stat-value">{{ formattedRound }}</div>
        </div>
        <div class="final-stat">
          <div class="stat-label">
            {{
              translationService.translate("game.finalScore", {
                score: formattedScore,
              })
            }}
          </div>
          <div class="stat-value">{{ formattedScore }}</div>
        </div>
      </div>
      <div class="status-bar error">
        <span class="status-indicator red blink"></span>
        <span class="status-text">AWAITING RESTART</span>
      </div>
      <button class="main-button" (click)="goToMenu()">
        {{ translationService.translate("game.backToMenu") }}
      </button>
      <button class="main-button primary" (click)="restartGame()">
        {{ translationService.translate("common.restart") }}
      </button>
    </div>
  </div>
</div>
